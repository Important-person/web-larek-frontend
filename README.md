# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src\scss\styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
## Используемые типы данных

Карточка

```
export interface ICard {
    id: string,
    description: string,
    image: string,
    title: string,
    category: string,
    price: number
}
```

Данные пользователя

```
export interface IUserInformation {
    paymentMethod: string,
    address: string,
    email: string,
    tell: string
}
```
Данные для отправки заказа 

```
export interface ISendOrder extends IUserInformation{
    id: string[];
    total: number;
}
```

Интерфейс для модели данных 

```
export interface IAppState {
    items: ICard[];
    order: ISendOrder;
    basket?: ICard[];
    openCard: ICard;
    total: number;
    isOrderReady: string | null;
    validationError: boolean;
    sumOrder: number;
}
```

Данные вводимые пользователем на первой страниуе оформления заказа

```
export type TUserInformationOne = Pick<IUserInformation, 'paymentMethod' | 'address'>
```

Данные вводимые пользователем на второй страниуе оформления заказа

```
export type TUserInformationTwo = Pick<IUserInformation, 'email' | 'tell'>
```

Тип объекта карточки добавленной в корзину

```
export type TCardBusketItem = Pick<ICard, 'id' | 'title' | 'price'>
```

Результат Оформления заказа

```
export interface IOrderResult {
    id: string;
    total: number;
}
```

## Архитектура приложения 

Код приложения будем разделять на слои в соответствии с парадигмой MVP:
1) Слой предствавления - он будет отвечать за отображение данных на странице пользователя;
2) Слой данных - отвечает за хранение и изменение наших данных;
3) Presenter - отвечает за связь между двумя вышеперечисленными слоями

### Базовый класс api

Содержит в себе логику отправки запросов и получения данных с сервера. Конструктор принимает на вход адрес сервера и объект содержащий заголовки запросов. В данном классе реализованны такие методы, как:
1) get - реализует отправку запроса для получение данных на передаваемый в аргументах ендпоинт и возвращает промис, содержащий объект с ответом от сервера;
2) post - реализует отправку данных на сервер, принимает в качестве аргументов: ендпоинт, объект с передаваемыми данными, метод отправки (по-умолчанию 'POST'). Возвращает объект с ответом от сервера

### Базовый класс events 

Брокер событий позволяет отправлять события м подписываться на события, происходящие с приложении. Класс используется в презентере для Обработки событий и в слоях приложения для генерации событий.
Основные методы класса: 
1) on - Установить обработчик на событие;
2) off - Снять обработчик с события;
3) emit - Инициировать событие с данными;
4) onAll - Слушать все события;
5) offAll - Сбросить все обработчики;
6) trigger - Сделать коллбек триггер, генерирующий событие при вызове

### Слой данных

#### Класс IAppState

Данный класс отвечает за хранение и логику работы с данными карточек. Конструктор класса принимает в качестве одного из аргументов инстант Брокера событий.
Поля класса:
1) items: ICard[] - хранит в себе массив товаров, полученный с сервера;
2) order: ISendOrder - хранит в себе объект с данными для отправки заказа на сервер;
3) basket: ICard[] - хранит в себе массив товаров добавленных в корзину;
4) openCard: ICard - хранит в сее товар открытый для просмотра;
5) isOrderReady: string | null - хранив в себе состояние заказа;
6) validationError: boolean - харнит в себе состояние проверки полей ввода данных на валидность;
7) sumOrder: number - хранит в себе сумму заказа;
8) numderOfItemsBusket: numder - хранит в себе количество добавленных в корзину товаров;

Метода класса:
1) getCard(id: string): ICard[] - метод для получения карточки товара по id;
2) addCardBusket(card: ICard): void - метод для добавлния карточки товара в корзину;
3) deleteCardBusket(id: string): void - метод для удаления карточки товара из корзины;
4) costOrder(prise: number[]): number - метод для расчета стоимости заказа;
5) setUserInformationOne(data: IUserInformationOne): void - метод для сохрания информации вводимой прользователем в первой форме (способ оплаты,   адрес);
6) getUserInformationOne(): IUserInformationOne - метод для получения информации вводимой прользователем в первой форме (способ оплаты, адрес);
7) setUserInformationTwo(data: IUserInformationTwo): void - метод для сохрания информации вводимой прользователем во второй форме (email, номер телефона);
8) getUserInformationTwo(): IUserInformationTwo - метод для получения информации вводимой прользователем во второй форме (email, номер телефона);
9) cleanUserInformationOne(): void - метод для очистки полей ввода информации прользователя в первой форме (способ оплаты, адрес);
10) cleanUserInformationTwo(): void - метод для очистки полей ввода информации прользователя во второй форме (способ оплаты, адрес);
11) validationMethod(data: Record<keyof IUserInformation, string>): boolean - метод валидации полей ввода;
12) setCardList(data: ICard[]): void - метод для схранения полученного с сервера каталога карточек товара.

### Слой представления

Данный слой отвечает за отображение внутри контейнера, предоставляемых в него данных. Слой отображения включает в себя такие кассы как:

#### Базовый класс отображения Component

Данный класс реализует общие для многих классов отображения, методы.
Поля класса:
1) container: HTMLElement - Поле container служит контейнером, в котором будут храниться HTML-элементы, представляющие собой различные компоненты страницы.

Методы класса:
1) setImage(element: HTMLImageElement, src: string, alt?: string) - данный метод устанавливает картинку, вынесен в базоный класс так как используется в нескольких элементах отображения;
2) setText(element: HTMLElement, text: <T>) - данный метод устанавливает текст в разные элементы отображения;
3) setDisabled(element: HTMLElement, state: boolean) - данный метод нужен для смены статуса блокировки кнопок в попапах;
4) render(data: Partial<T>): HTMLElement - обновляет состояние компонента, присваивая свойства из объекта data текущему экземпляру класса.

#### Класс Basket 

Данный класс наследуется от базового класса Component и  отвечает за отображение корзины, ее наполнение товарами, отображение стоимости заказа. Конструктор класса в качестве аргументов принимает инстант брокера событий и контейнер, который будет использоваться при взаимодействии с элементами корзины.
Поля класса:
1) _list: HTMLElement[] - данное поле хранит в себе массив HTML-элементов добавленных товаров;
2) _cost: HTMLElement - данное поле хранит в себе HTML-элемент суммы заказа;
3) _button: HTMLButtonElement - данное поле хранит в себе HTML-элемент кнопки "оформить".

Методы класса:
1) setItems(elements: HTMLElement[]) - метод для добавления товара в корзину;
2) status(elements: string[]) - метод для обновления состояния кнопки оформления заказа;
3) setCost(cost: number) - метод для отображения стоимотси заказа в корзине;
4) deleteItem(element: HTMLElement) - метод для удаления элемента заказа из DOM.

#### Класс Modal

Данный класс наследуется от базового класса Component и отвечает за открытие и закрытие модального окна, и его содержимого (template),
модальное окно создаваемое данным классом наполняется содержимым разных temlate. Конструктор класса в качестве аргументов принимает инстант брокера событий и контейнер.
Поля класса:
1) _closeButton: HTMLButtonElement -данное поле хранит в себе HTML-элемент кнопки закрытия модального окна;
2) _content: HTMLElement - данное поле хранит в себе template отображаемого элемента.

Методы класса:
1) setcontent(element: HTMLElement) - данный метод используется чтобы наполнять содержимым модальное окно;
2) open() - метод для открытия модального окна;
3) close() - метод для закрытия модального окна;
4) render(data: object): HTMLELement - данный метод возвращает корневой элемент.

#### Класс Form
Данный класс наследуется от базового класса Component и отвечает  за валидацию полей ввода и отображение ошибки валидации. Конструктор класса в качестве аргументов принимает инстант брокера событий и контейнер.
Поля класса:
1) _button: HTMLButtonElement - данное поле хранит в себе HTML-элемент кнопки "далее";
2) _buttonSubmit: HTMLElement - данное поле хранит в себе HTML-элемент кнопки submit;
2) _input: HTMLElement - данное поле хранит в себе HTML-елемент поля ввода;
3) _buttonAlt: HTMLButtonElement[] - данное поле хранит в себе HTML-елементы кнопок выбора способа оплаты;
4) _error: HTMLElement - данное поле хранит в себе HTML-елемент ошибки.

Методы класса:
1) setvalidation(valid: boolean) - данный метод используется для определения состояния _button;
2) error(massege: string) - метод для отображения сообщения об ошибке, получаемого с сервера;
3) OnInput() - метод для отслеживания события input в поле адреса;
4) render(data: object): HTMLELement - данный метод предназначен для обновления состояния и отображения формы на основе переданных данных.

#### Класс Success
Данный класс наследуется от базового класса Component и отвечает  за валидацию полей ввода и отображение ошибки валидации. Конструктор класса в качестве аргументов принимает инстант брокера событий и контейнер.
Поля класса:
1) _buttonClose: HTMLButtonElement - хранит в себе HTML-елемент кнопки "за новыми покупками";
2) _cost: HTMLElement - данное поле хранит в себе HTML-элемент суммы заказа.

Методы класса:
1) setCost(cost: number) - метод для отображения стоимоcти заказа.

#### Класс Card
Данный класс наследуется от базового класса Component и отвечает за отображение карточки товара в разных форматах. Конструктор класса в качестве аргументов принимает инстант брокера событий и template карточки в нужной формате.
Поля класса:
1) _category: HTMLElement - данное поле хранит в себе HTML-элемент категории товара;
2) _image?: HTMLImageElement - данное поле хранит в себе HTML-елемент картинки товара;
3) _description?: HTMLElement - данное поле хранит в себе HTML-елемент описания товара;
4) _price: HTMLElement - данное поле хранит в себе HTML-елемент цены товара;
5) _button?: HTMLButoonElement - данное поле хранит в себе HTML-елемент кнопки "купить".

Методы класса:
1) setData(cardData: ICard) - данный метод используется для заполнения трибутов элементов карточки;
2) error(massege: string) - метод для отображения сообщения об ошибке;
4) render(): HTMLELement - данный метод пвозвращает заполненый элемент карточки со слушателями.
5) getId(): string - метод для получения id карточки.

#### Класс Page
Данный класс отвечает за отображение массива карточек на главной странице, количества товаров в корзине и установки слушателя для клика по корзине. В конструктор принимает контейнер в котором будут размещены элементы и инстант брокера событий.
Поля класса:
1) _catalog: HTMLElement - данное поле эранит в себе контейнер для отображения массива карточек;
2) _buttonBusket: HTMLButtonElement - данное поле хранит в себе HTML-елемент корзины товаров;
3) _counter: HTMLElement - данное поле хранит в себе HTML-елемент количества товаров в корзине.

Методы класса:
1) setCatalog(items: ICard[]) - данный метод используется для наполнения контейнера карточками товаров;
2) setCounter(items: number) - данный метод используется для установки количества товаров в корзине.

### Слой коммуникации

### Класс AppAPI
Принимает в конструктор экземпляр класса API и дает методы для взаимодельствия с сервером.
Методы класса: 
1) getCardItems(): Promise<ICard[]> - метод для получения массива карочек товаров с сервера;
2) orderItems(items: ISendOrder): Promise<IOrderResult> - метод для отправки заказа на сервер.

## Взаимодействие компонентов 
Код взаимодействия модели данных и классов отображения находится в коренвом файле `index.ts` выполняющем роль презентера.\
Взаимодействие компонентов осуществляется за чет генерации событий с помощьюброкера событий `events.ts`.\
В презентере `index.ts` сначала создаются эеземпняры всех необходимых классов, а потом натсраивается обработка событий.

*Список событий которые могут генерироваться:*
1) `card:open` - событие открытия модального окна просмотра карточки товара;
2) `busket:open` - событие открытия модального окна просмотра корзины в гласвной страницы;
3) `card__button:click` - нажатие на кнопку добавить в корзину;
4) `basket__item-delete:delete` - нажатие на кнопуку удалить товар из корзины;
5) `basket__button:click` - нажатие на кнопку оформить заказ в корзине;
6) `button_alt:selected` - выбор способа оплаты;
7) `address:input` - ввод адреса пользователем;
8) `order__button:click` - нажатие на кнопку "далее";
9) `email:input` - ввод email позователем;
10) `button:submit` - отправка данных заказа на сервер;
11) `order-success__close:click` - заказ выполнен успешно, закрыть модальное окно;
12) `modal__close:click` - закрытие модального окна через крестик;
13) `form__errors__oreder:validation` - событие, сообщающее о необходимости валидации формы `name="order"`;
14) `form__errors__order:validation` - cсобытие, сообщающее о необходимости валидации формы `name="contacts"`
15) `input:clean` - событие сообщающее о необходимости очистки полей ввода персональной информации пользователя.












